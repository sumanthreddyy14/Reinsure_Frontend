<div class="page-bg">
<app-quick-links></app-quick-links>
<mat-card>
  <mat-card-title>Treaties</mat-card-title>
  <mat-card-content>
    <div class="filters">
      <mat-form-field>
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="status">
          <mat-option value="">All</mat-option>
          <mat-option value="ACTIVE">Active</mat-option>
          <mat-option value="EXPIRED">Expired</mat-option>
          <mat-option value="ARCHIVED">Archived</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Type</mat-label>
        <mat-select [(ngModel)]="type">
          <mat-option value="">All</mat-option>
          <mat-option value="PROPORTIONAL">Proportional</mat-option>
          <mat-option value="NON-PROPORTIONAL">Non-Proportional</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="reinsurer" />
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="fetch()">Apply</button>
      <!-- <button mat-raised-button color="primary" (click)="loadDummyData()">Apply</button> -->
      <a mat-button color="accent" routerLink="/treaties/new">New Treaty</a>
    </div>

    <mat-form-field class="full">
      <mat-label>Search</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Find by reinsurer, status, type..." />
    </mat-form-field>

    <div class="table-wrapper">
      <table mat-table [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="treatyId">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let row">{{ row.treatyId }}</td>
        </ng-container>

        <ng-container matColumnDef="reinsurerName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ReinsurerName</th>
          <td mat-cell *matCellDef="let row">{{ row.reinsurerName }}</td>
        </ng-container>

        <ng-container matColumnDef="reinsurerId">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ReinsurerId</th>
          <td mat-cell *matCellDef="let row">{{ row.reinsurerId }}</td>
        </ng-container>

        <ng-container matColumnDef="treatyType">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
          <td mat-cell *matCellDef="let row">{{ row.treatyType }}</td>
        </ng-container>

        <ng-container matColumnDef="coverageLimit">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Coverage Limit</th>
          <td mat-cell *matCellDef="let row">{{ row.coverageLimit | number:'1.0-2' }}</td>
        </ng-container>

        <ng-container matColumnDef="period">
          <th mat-header-cell *matHeaderCellDef>Period</th>
          <td mat-cell *matCellDef="let row">{{ row.startDate }} â†’ {{ row.endDate }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let row">
            <mat-chip *ngIf="row.status === 'ACTIVE'" color="primary" selected>{{ row.status }}</mat-chip>
            <mat-chip *ngIf="row.status === 'EXPIRED'" color="warn" selected>{{ row.status }}</mat-chip>
            <mat-chip *ngIf="row.status === 'ARCHIVED'" color="accent" selected>{{ row.status }}</mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let row">
            <!-- <a mat-button color="primary" [routerLink]="['/treaties', row.treatyId]">View</a> -->
             <button mat-button color="primary" (click)="go(row.treatyId)">View</button>
            <a mat-button color="accent" [routerLink]="['/treaties', row.treatyId, 'edit']">Edit</a>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <mat-paginator [pageSize]="10"></mat-paginator>
    </div>

    <div class="loading" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
  </mat-card-content>
</mat-card>
</div>